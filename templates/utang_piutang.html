<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Manajemen Utang & Piutang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-slate-100">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-8 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-slate-900">Manajemen Utang & Piutang</h1>
                <p class="text-slate-500 mt-1">Lacak semua pinjaman yang Anda miliki atau berikan.</p>
            </div>
            <div class="flex gap-3">
                 <a href="{{ url_for('index') }}" class="text-slate-700 bg-white font-semibold py-2 px-4 rounded-lg shadow-sm border border-slate-200 hover:bg-slate-50">Kembali ke Dashboard</a>
                <a href="{{ url_for('tambah_utang_piutang') }}" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-lg shadow-md">+ Tambah Baru</a>
            </div>
        </header>

        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-slate-200">
                    <thead class="bg-slate-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Tipe</th>
                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Deskripsi</th>
                            <th class="px-4 py-3 text-left text-xs font-bold text-slate-600 uppercase">Pihak Terkait</th>
                            <th class="px-4 py-3 text-right text-xs font-bold text-slate-600 uppercase">Sisa Pembayaran</th>
                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Progres</th>
                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Status</th>
                            <th class="px-4 py-3 text-center text-xs font-bold text-slate-600 uppercase">Aksi</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-slate-100">
                        {% for item in items %}
                        {% set sisa = item.jumlah_total - item.jumlah_terbayar %}
                        {% set progres = (item.jumlah_terbayar / item.jumlah_total * 100) if item.jumlah_total > 0 else 0 %}
                        <tr class="hover:bg-slate-50">
                            <td class="px-4 py-4 whitespace-nowrap">
                                {% if item.tipe == 'Utang' %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-rose-100 text-rose-800">Utang</span>
                                {% else %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-sky-100 text-sky-800">Piutang</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap font-medium text-slate-800">{{ item.deskripsi }}</td>
                            <td class="px-4 py-4 whitespace-nowrap text-sm text-slate-500">{{ item.pihak_terkait }}</td>
                            <td class="px-4 py-4 whitespace-nowrap text-right font-semibold">Rp {{ "{:,.2f}".format(sisa) }}</td>
                            <td class="px-4 py-4 whitespace-nowrap">
                                <div class="w-full bg-slate-200 rounded-full h-2.5">
                                    <div class="h-2.5 rounded-full {% if item.tipe == 'Utang' %}bg-rose-500{% else %}bg-sky-500{% endif %}" style="width: {{ [100, progres]|min|int }}%"></div>
                                </div>
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap text-center">
                                {% if item.lunas %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">Lunas</span>
                                {% else %}
                                <span class="px-2 py-1 text-xs font-semibold rounded-full bg-slate-100 text-slate-800">Belum Lunas</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-4 whitespace-nowrap text-center text-sm">
                                <a href="#" class="text-amber-600 hover:text-amber-800 font-medium mr-3">Bayar</a>
                                <a href="{{ url_for('hapus_utang_piutang', id=item.id) }}" class="text-slate-500 hover:text-rose-600" onclick="return confirm('Yakin ingin menghapus catatan ini? Ini tidak bisa dikembalikan.')">Hapus</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
